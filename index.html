<script>
  const salesSelect = document.getElementById('salesperson');
  const clientSelect = document.getElementById('client');
  const zoneSelect = document.getElementById('zone');

  let customersData = [];

  // Load salespersons list from salespersons.json (unchanged)
  fetch('salespersons.json')
    .then(response => response.json())
    .then(data => {
      data.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        salesSelect.appendChild(option);
      });
    });

  // Load customers list from CSV
  fetch('customers.csv')
    .then(response => response.text())
    .then(csvText => {
      const rows = csvText.trim().split('\n').slice(1); // skip header
      customersData = rows.map(row => {
        const [name, zone] = row.split(',');
        return { name: name.trim(), zone: zone.trim() };
      });
    });

  // Filter customers when zone changes
  zoneSelect.addEventListener('change', () => {
    const selectedZone = zoneSelect.value;
    clientSelect.innerHTML = "";
    const filteredCustomers = customersData.filter(c => c.zone === selectedZone);

    filteredCustomers.forEach(cust => {
      const option = document.createElement('option');
      option.value = cust.name;
      option.textContent = cust.name;
      clientSelect.appendChild(option);
    });
  });

  // Get location
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(position => {
      document.getElementById('latitude').value = position.coords.latitude;
      document.getElementById('longitude').value = position.coords.longitude;
    });
  }

  // Submit form
  document.getElementById('checkinForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    formData.append('timestamp', new Date().toISOString());

    fetch('YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL', {
      method: 'POST',
      body: formData
    })
    .then(res => res.text())
    .then(response => {
      document.getElementById('message').textContent = "Check-in successful!";
      this.reset();
    })
    .catch(err => {
      document.getElementById('message').textContent = "Error: " + err;
    });
  });
</script>
